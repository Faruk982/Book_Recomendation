{% extends "base.html" %}

{% block title %}Search{% endblock title %}

{% block body %}
<style>
    .results-table {
        width: 60%;
        border-collapse: collapse;
        margin-top: 20px;
        margin-left: 250px;
    }

    .results-table td {
        padding: 20px;
        vertical-align: top;
        border-bottom: 1px solid #ddd;
        background-color: #ffffff;
    }

    .book-info {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 80%; /* Reduce the width */
        margin: 0 auto; /* Center the content horizontally */
    }

    .book-cover img {
        width: 50px;
        height: auto;
        border-radius: 5px;
        margin-right: 15px;
    }

    .book-details {
        display: flex;
        flex-direction: column;
        text-align: left;
        max-width: 500px; /* Limit the width of book details */
    }

    .book-title {
        font-size: 1.25rem;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .book-author {
        font-size: 1rem;
        color: #555;
        margin-bottom: 5px;
    }

    .book-meta {
        font-size: 0.9rem;
        color: #777;
    }

    .no-results {
        text-align: center;
        font-size: 1.2rem;
        color: #666;
        margin-top: 20px;
    }
</style>

<div class="container mt-5">
    <h1 class="text-center mb-4">Search for Books</h1>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <form action="{% url 'search' %}" method="POST" class="p-4 bg-white shadow rounded">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="book_name" class="form-label">Book Name</label>
                    <input type="text" id="book_name" name="book_name" class="form-control" placeholder="Enter the book name">
                </div>
                <div class="mb-3">
                    <label for="author" class="form-label">Author</label>
                    <input type="text" id="author" name="author" class="form-control" placeholder="Enter the author's name">
                </div>
                <div class="mb-3">
                    <label for="genre" class="form-label">Genre</label>
                    <input type="text" id="genre" name="genre" class="form-control" placeholder="Enter the genre">
                </div>
                <div class="text-center">
                    <button type="submit" class="btn btn-primary w-100">Search</button>
                </div>
            </form>
        </div>
    </div>

    {% if results %}
        <h2 class="text-center mt-5">Search Results</h2>
        <table class="results-table">
            {% for book in results %}
            <tr>
                <td width="100%" valign="top">
                    <div class="book-info">
                        <!-- Book Cover -->
                        <div class="book-cover">
                            <img src="{{ book.image.url }}" alt="{{ book.book_name }}">
                        </div>
                        <!-- Book Details -->
                        <div class="book-details">
                            <div class="book-title">
                                <!-- Check if the book has an ID before generating the link -->
                                {% if book.book_id %}
                                <a href="{% url 'book' book.book_id %}">{{ book.book_name }}</a>

                                {% else %}
                                    {{ book.book_name }}
                                {% endif %}
                            </div>
                            <div class="book-author">by <a href="{% url 'author' pk=book.author_id.pk %}">{{ book.author_id.name }}</a></div>
                            <div class="book-meta">
                                <span>Genre: {{ book.genre }}</span><br>
                                <span>Rating: {{ book.avg_rating }} ({{ book.total_ratings }} ratings)</span>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% elif results is not None %}
        <p class="no-results">No books found. Please try a different search.</p>
    {% endif %}
</div>
{% endblock body %}
